<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>

  
  <meta name="author" content="易建勇,YI_joy">
  

  
  <meta name="description" content="拖拽交换位置的实现 | 前端技术空间">
  

  
  <meta name="keywords" content="布局转换  拖拽  检测碰撞">
  

  

  <title>拖拽交换位置的实现 | 前端技术空间</title>

  <link rel="stylesheet" href="/css/blog.css">
</head>
<body>

<div class="blog">

<div class="navigation">
  <ul class="nav-list">
    
      <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
    
      <li class="nav-item"><a class="nav-link" href="/archives">Archives</a></li>
    
  </ul>
</div>

<div class="post">

  <h1 class="post-title">拖拽交换位置的实现</h1>

  <time class="post-time">2013-07-15</time>

  <div class="post-content">
    <p>什么是拖拽交换位置？看下图就明了，我们拖动里面的某个灰色方块，然后与其他灰色方块相互碰撞，如果那个方块离它的位置最近，则一开始那个方块出现红色虚线边框，松开鼠标然后这两者就进行位置互换。</p>
<a id="more"></a>
<img src="/2013/07/15/drag-exchange-position/dragMove.gif" title="拖动交换位置">
<p>对于这种效果，看似有些复杂。不过再复杂的效果还是由许多简单的事件构成的。以下就此效果做分部解析：</p>
<p><strong>第一步 布局</strong></p>
<p>或者对于你而言，这样的布局是简单的。但是如果需要让方块能够被拖拽，恐怕必须是绝对定位才能完成。而且在未知区域里方块的个数，你是无法对每个去计算他们对应的left和top值的，这个时候我们必须通过js来完成这种布局上的转换。</p>
<p>首先放上css和html代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;<span class="attribute">list-style</span>:none;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-id">#box</span>&#123;<span class="attribute">width</span>:<span class="number">300px</span>;<span class="attribute">margin</span>:<span class="number">0</span> auto;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-id">#box</span> <span class="selector-tag">li</span>&#123;<span class="attribute">width</span>:<span class="number">80px</span>;<span class="attribute">height</span>:<span class="number">80px</span>;<span class="attribute">float</span>:left;<span class="attribute">margin</span>:<span class="number">10px</span>;<span class="attribute">background</span>:<span class="number">#ccc</span>;<span class="attribute">line-height</span>:<span class="number">80px</span>;<span class="attribute">text-align</span>:center;<span class="attribute">display</span>:inline;<span class="attribute">cursor</span>:pointer;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-id">#box</span> <span class="selector-class">.act</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> dashed red;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">”box”</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>111<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>222<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>333<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>444<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>555<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>666<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>777<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>888<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>999<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后对于列表进行布局转换：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> oBox=<span class="built_in">document</span>.getElementById(<span class="string">"box"</span>),</span><br><span class="line">  aLi=oBox.getElementsByTagName(<span class="string">"li"</span>),</span><br><span class="line">  i=<span class="number">0</span>,</span><br><span class="line">  len=aLi.length,</span><br><span class="line">  aPos=[];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">    aPos[i]=&#123;<span class="attr">left</span>:aLi[i].offsetLeft,<span class="attr">top</span>:aLi[i].offsetTop&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">    aLi[i].style.left=aPos[i].left+<span class="string">"px"</span>;</span><br><span class="line">    aLi[i].style.top=aPos[i].top+<span class="string">"px"</span>;</span><br><span class="line">    aLi[i].style.position=<span class="string">"absolute"</span>;</span><br><span class="line">    aLi[i].style.margin=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时每个li都有对应的left和top值，如下图：</p>
<img src="/2013/07/15/drag-exchange-position/dragP.jpg" title="布局转换后的列表">
<p><strong>第二步 对每个方块进行拖拽操作</strong></p>
<p>关于拖拽，有以下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drag</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> iMinZindex=<span class="number">100</span></span><br><span class="line">    obj.onmousedown=<span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">        clearInterval(obj.timer);</span><br><span class="line">        iMinZindex++;</span><br><span class="line">        obj.style.zIndex=iMinZindex;</span><br><span class="line">        <span class="keyword">var</span> e=ev||event;</span><br><span class="line">        <span class="keyword">var</span> disX=e.clientX-obj.offsetLeft;</span><br><span class="line">        <span class="keyword">var</span> disY=e.clientY-obj.offsetTop;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(obj.setCapture)&#123;</span><br><span class="line">            obj.onmousemove=fnMove;</span><br><span class="line">            obj.onmouseup=fnUp;</span><br><span class="line">            obj.setCapture();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.onmousemove=fnMove;</span><br><span class="line">            <span class="built_in">document</span>.onmouseup=fnUp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">fnMove</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> e=ev||event;</span><br><span class="line">            x=e.clientX-disX;</span><br><span class="line">            y=e.clientY-disY;</span><br><span class="line">            obj.style.left=x+<span class="string">"px"</span>;</span><br><span class="line">            obj.style.top=y+<span class="string">"px"</span>;   </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">fnUp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.onmousemove=<span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">this</span>.onmouseup=<span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.setCapture)&#123;</span><br><span class="line">                <span class="keyword">this</span>.releaseCapture();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//对每个li进行拖拽处理</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">    drag(aLi[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，每个li都可以进行随意的拖动了，并且每拖动一次，li的zIndex就会加1，所以，最后一个拖动的li层级总是最高的。</p>
<p><strong>第三步 两个方块碰撞的条件？</strong></p>
<p>假设碰撞的两个方块分别是obj1和obj2，obj1是被拖拽的方块，那么怎么样才能判断它们两个是否碰撞了呢？这里我们给出了一个反向思路，即obj1和obj2不碰撞的产生条件是什么？</p>
<ol>
<li>obj1的右边框要小于obj2的左边框</li>
</ol>
<p>2.obj1的左边框要大于obj2的右边框</p>
<p>3.obj1的下边框要小于obj2的上边框</p>
<p>4.obj1的上边框要大于obj2的下边框</p>
<p>以上四种情况均可以使得obj1和obj2不碰撞。于是我们得到函数delect：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//碰撞检测</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delect</span>(<span class="params">obj1,obj2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> l1=obj1.offsetLeft,</span><br><span class="line">        r1=obj1.offsetLeft+obj1.offsetWidth,</span><br><span class="line">        t1=obj1.offsetTop,</span><br><span class="line">        b1=obj1.offsetTop+obj1.offsetHeight,</span><br><span class="line">        l2=obj2.offsetLeft,</span><br><span class="line">        r2=obj2.offsetLeft+obj2.offsetWidth,</span><br><span class="line">        t2=obj2.offsetTop,</span><br><span class="line">        b2=obj2.offsetTop+obj2.offsetHeight;</span><br><span class="line">    <span class="keyword">if</span>(r1&lt;l2||l1&gt;r2||b1&lt;t2||t1&gt;b2)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们通过delect函数的返回值，就能知道两个物体是否发生了碰撞。</p>
<p><strong>第四步 当同时与多个方块碰撞，求最短距离，并得到最短距离的方块</strong></p>
<p>首先，当被拖拽的物体同时与几个方块相互碰撞时，则我们首先求出这些方块与被拖拽方块的距离，距离函数如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//两方块距离</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dist</span>(<span class="params">obj1,obj2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a=obj1.offsetLeft-obj2.offsetLeft,</span><br><span class="line">      b=obj1.offsetTop-obj2.offsetTop;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(a*a+b*b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再对这些方块的距离进行比较，从而返回那个与它位置最近的方块。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//最近距离</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shortestDis</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> iNow=<span class="number">-1</span>,iMin=<span class="number">99999</span>;  <span class="comment">//这里iNow不能等于0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(obj==aLi[i])<span class="keyword">continue</span>; <span class="comment">//如果没有发生任何碰撞，则跳过</span></span><br><span class="line">        <span class="keyword">if</span>(delect(obj,aLi[i]))&#123;</span><br><span class="line">            <span class="keyword">var</span> dis=dist(obj,aLi[i]);</span><br><span class="line">            <span class="keyword">if</span>(dis&lt;iMin)&#123;    <span class="comment">//比较求出最小的距离</span></span><br><span class="line">                iMin=dis;</span><br><span class="line">                iNow=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(iNow==<span class="number">-1</span>)&#123;   <span class="comment">//没有发生碰撞的情况</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;  <span class="comment">//发生碰撞情况，并返回最短距离的块</span></span><br><span class="line">        <span class="keyword">return</span> aLi[iNow];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，通过这个函数我们得到了最短距离的方块，我们需要给它加一个红色边框，而这些操作都是拖动的过程中完成的，于是我们回到拖动的过程中，有：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fnMove</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e=ev||event;</span><br><span class="line">    x=e.clientX-disX;</span><br><span class="line">    y=e.clientY-disY;</span><br><span class="line">    obj.style.left=x+<span class="string">"px"</span>;</span><br><span class="line">    obj.style.top=y+<span class="string">"px"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        aLi[i].className=<span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> near=shortestDis(obj);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(near)&#123;</span><br><span class="line">        near.className=<span class="string">"act"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第五步 两个碰撞的方块进行位置互换</strong></p>
<p>虽然我们知道交换位置是在释放鼠标时完成的。但是我们并不知道被我们拖拽的方块的索引值，这样我们就无法对这两个方块的进行位置赋值，怎么办呢？如果我们分别知道这被拖动的方块和距离最近的方块的索引值，再依据之前提到的aPos[i]，那么这两个方块的位置就可以确定了，于是我们在开始循环的时候，给每个li加索引值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">    aLi[i].style.left=aPos[i].left+<span class="string">"px"</span>;</span><br><span class="line">    aLi[i].style.top=aPos[i].top+<span class="string">"px"</span>;</span><br><span class="line">    aLi[i].style.position=<span class="string">"absolute"</span>;</span><br><span class="line">    aLi[i].style.margin=<span class="number">0</span>;</span><br><span class="line">    aLi[i].index=i;  <span class="comment">//加索引值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fnUp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.onmousemove=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.onmouseup=<span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> near=shortestDis(obj);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(near)&#123;  <span class="comment">//碰撞到了方块</span></span><br><span class="line">        obj.style.left=aPos[near.index].left+<span class="string">"px"</span>;</span><br><span class="line">        obj.style.top=aPos[near.index].top+<span class="string">"px"</span>;</span><br><span class="line">        near.style.left=aPos[obj.index].left+<span class="string">"px"</span>;</span><br><span class="line">        near.style.top=aPos[obj.index].top+<span class="string">"px"</span>;</span><br><span class="line">        near.className=<span class="string">""</span>;</span><br><span class="line">        near.style.zIndex=iMinZindex;</span><br><span class="line">        <span class="keyword">var</span> temp=obj.index; <span class="comment">//交换位置时，同时把li的序列号也交换。避免再次交换时，回到被碰撞方块的初始位置</span></span><br><span class="line">        obj.index=near.index;</span><br><span class="line">        near.index=temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;   <span class="comment">//没有碰撞任何方块</span></span><br><span class="line">        obj.style.left=aPos[obj.index].left+<span class="string">"px"</span>;</span><br><span class="line">        obj.style.top=aPos[obj.index].top+<span class="string">"px"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.setCapture)&#123;</span><br><span class="line">        <span class="keyword">this</span>.releaseCapture();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整个效果就是以上的五个步骤。完整代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oBox=<span class="built_in">document</span>.getElementById(<span class="string">"box"</span>),aLi=oBox.getElementsByTagName(<span class="string">"li"</span>),i=<span class="number">0</span>,len=aLi.length,aPos=[];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        aPos[i]=&#123;<span class="attr">left</span>:aLi[i].offsetLeft,<span class="attr">top</span>:aLi[i].offsetTop&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        aLi[i].style.left=aPos[i].left+<span class="string">"px"</span>;</span><br><span class="line">        aLi[i].style.top=aPos[i].top+<span class="string">"px"</span>;</span><br><span class="line">        aLi[i].style.position=<span class="string">"absolute"</span>;</span><br><span class="line">        aLi[i].style.margin=<span class="number">0</span>;</span><br><span class="line">        aLi[i].index=i;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">drag</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> iMinZindex=<span class="number">100</span></span><br><span class="line">        obj.onmousedown=<span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">            clearInterval(obj.timer);</span><br><span class="line">            iMinZindex++;</span><br><span class="line">            obj.style.zIndex=iMinZindex;</span><br><span class="line">            <span class="keyword">var</span> e=ev||event;</span><br><span class="line">            <span class="keyword">var</span> disX=e.clientX-obj.offsetLeft;</span><br><span class="line">            <span class="keyword">var</span> disY=e.clientY-obj.offsetTop;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(obj.setCapture)&#123;</span><br><span class="line">                obj.onmousemove=fnMove;</span><br><span class="line">                obj.onmouseup=fnUp;</span><br><span class="line">                obj.setCapture();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">document</span>.onmousemove=fnMove;</span><br><span class="line">                <span class="built_in">document</span>.onmouseup=fnUp;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">fnMove</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> e=ev||event;</span><br><span class="line">                x=e.clientX-disX;</span><br><span class="line">                y=e.clientY-disY;</span><br><span class="line">                obj.style.left=x+<span class="string">"px"</span>;</span><br><span class="line">                obj.style.top=y+<span class="string">"px"</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">                    aLi[i].className=<span class="string">""</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">var</span> near=shortestDis(obj);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(near)&#123;</span><br><span class="line">                    near.className=<span class="string">"act"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">document</span>.title=obj.index;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">fnUp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.onmousemove=<span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">this</span>.onmouseup=<span class="literal">null</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">var</span> near=shortestDis(obj);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(near)&#123;</span><br><span class="line">                    obj.style.left=aPos[near.index].left+<span class="string">"px"</span>;</span><br><span class="line">                    obj.style.top=aPos[near.index].top+<span class="string">"px"</span>;</span><br><span class="line">                    near.style.left=aPos[obj.index].left+<span class="string">"px"</span>;</span><br><span class="line">                    near.style.top=aPos[obj.index].top+<span class="string">"px"</span>;</span><br><span class="line">                    near.className=<span class="string">""</span>;</span><br><span class="line">                    near.style.zIndex=iMinZindex;</span><br><span class="line">                    <span class="keyword">var</span> temp=obj.index;</span><br><span class="line">                    obj.index=near.index;</span><br><span class="line">                    near.index=temp;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    obj.style.left=aPos[obj.index].left+<span class="string">"px"</span>;</span><br><span class="line">                    obj.style.top=aPos[obj.index].top+<span class="string">"px"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.setCapture)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.releaseCapture();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        drag(aLi[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delect</span>(<span class="params">obj1,obj2</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> l1=obj1.offsetLeft,</span><br><span class="line">            r1=obj1.offsetLeft+obj1.offsetWidth,</span><br><span class="line">            t1=obj1.offsetTop,</span><br><span class="line">            b1=obj1.offsetTop+obj1.offsetHeight,</span><br><span class="line">            l2=obj2.offsetLeft,</span><br><span class="line">            r2=obj2.offsetLeft+obj2.offsetWidth,</span><br><span class="line">            t2=obj2.offsetTop,</span><br><span class="line">            b2=obj2.offsetTop+obj2.offsetHeight;</span><br><span class="line">        <span class="keyword">if</span>(r1&lt;l2||l1&gt;r2||b1&lt;t2||t1&gt;b2)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dist</span>(<span class="params">obj1,obj2</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a=obj1.offsetLeft-obj2.offsetLeft,</span><br><span class="line">            b=obj1.offsetTop-obj2.offsetTop;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(a*a+b*b);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">shortestDis</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> iNow=<span class="number">-1</span>,iMin=<span class="number">99999</span>; </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(obj==aLi[i])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(delect(obj,aLi[i]))&#123;</span><br><span class="line">                <span class="keyword">var</span> dis=dist(obj,aLi[i]);</span><br><span class="line">                <span class="keyword">if</span>(dis&lt;iMin)&#123;    </span><br><span class="line">                    iMin=dis;</span><br><span class="line">                    iNow=i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(iNow==<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> aLi[iNow];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
  </div>

</div>

  <div class="footer">
    <a href="http://www.yi-jy.com">前端技术空间--易建勇</a> /
    <a href="http://www.beianbeian.com/search/yi-jy.com">Copyright © 2012-2018</a> /
    <a href="https://github.com/joy-yi0905/hexo-theme-record">Record</a> /
    <a href="http://yi-jy.com/atom.xml">Rss</a>
  </div>

</div>

</body>


    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7d5550c80ba3b42cfa5323fc0e92699f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


</html>