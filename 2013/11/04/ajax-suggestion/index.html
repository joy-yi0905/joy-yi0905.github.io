<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>

  
  <meta name="author" content="易建勇,YI_joy">
  

  
  <meta name="description" content="ajax实现简单的文本框输入提示 | 前端技术空间">
  

  
  <meta name="keywords" content="ajax文本输入提示">
  

  

  <title>ajax实现简单的文本框输入提示 | 前端技术空间</title>

  <link rel="stylesheet" href="/css/blog.css">
</head>
<body>

<div class="blog">

<div class="navigation">
  <ul class="nav-list">
    
      <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
    
      <li class="nav-item"><a class="nav-link" href="/archives">Archives</a></li>
    
  </ul>
</div>

<div class="post">

  <h1 class="post-title">ajax实现简单的文本框输入提示</h1>

  <time class="post-time">2013-11-04</time>

  <div class="post-content">
    <p>近来事多时少，所以博客更新的日期也比较滞后。其实大多时间，还是受感情牵制，于是便有了情绪的起伏不定，自然也没有做事的心思了。</p>
<p>关于文本框输入提示，网页上随处可见。比如新浪微博的登录，最常用的莫过于搜索输入了，比如百度搜索：</p>
<a id="more"></a>
<img src="/2013/11/04/ajax-suggestion/baidu_input.jpg" title="百度输入提示">
<p><strong>说说原理</strong></p>
<p>它们都是根据用户在文本框输入的内容，然后再通过ajax请求服务器文件，读取到文件后再利用正则进行匹配，最后将符合要求的字符加入文本框下面的列表并显示，而且列表的数据是根据用户的输入来不断更新的。由于不懂服务器语言，这里请求的就拿一个固定js数组举例。</p>
<p><strong>问题点</strong></p>
<p>①. ajax无法解析返回的数组？ 经研究，使用eval便可解析数组。</p>
<p>②. 无法通过用户输入的字符去动态更新可选列表？ 经研究，能根据用户输入的字符长度(valLen)，在利用substring(0,valLen)去匹配相关字符将其显示于列表。</p>
<p>③. ie6下使用键盘↓键选择可选列表后，回车无法隐藏可选列表？  经研究，可以用onkeyup代替onkeydown去操作可选列表。</p>
<p>实例效果和代码：</p>
<img src="/2013/11/04/ajax-suggestion/input_sug1.gif" title="演示图">
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#ul</span>&#123;<span class="attribute">width</span>:<span class="number">150px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#555</span>;<span class="attribute">border-top</span>:none;<span class="attribute">line-height</span>:<span class="number">26px</span>;<span class="attribute">display</span>:none;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-id">#ul</span> <span class="selector-tag">li</span>&#123;<span class="attribute">padding-left</span>:<span class="number">10px</span>;&#125;</span></span><br><span class="line"><span class="css"><span class="selector-id">#ul</span> <span class="selector-class">.cur</span>&#123;<span class="attribute">background</span>:<span class="number">#ccc</span>;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"txt"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"ul"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">//ajax四部曲</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">ajax</span><span class="params">(url,fnSuccess,fnFail)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> oAjax=<span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span></span><br><span class="line"><span class="actionscript">            oAjax=<span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="actionscript">            oAjax=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="actionscript">        oAjax.open(<span class="string">"GET"</span>,url,<span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="undefined">        oAjax.send();</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="actionscript">        oAjax.onreadystatechange=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span>(oAjax.readyState==<span class="number">4</span> &amp;&amp; oAjax.status==<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="undefined">                fnSuccess(oAjax.responseText);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span>(fnFail)&#123;</span></span><br><span class="line"><span class="undefined">                    fnFail();</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> oTxt=<span class="built_in">document</span>.getElementById(<span class="string">"txt"</span>),</span></span><br><span class="line"><span class="javascript">        oUl=<span class="built_in">document</span>.getElementById(<span class="string">"ul"</span>),</span></span><br><span class="line"><span class="undefined">        c=-1,</span></span><br><span class="line"><span class="undefined">        oldVal=oTxt.value,</span></span><br><span class="line"><span class="actionscript">        aLi=oUl.getElementsByTagName(<span class="string">"li"</span>);;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="actionscript">    oTxt.onkeyup=<span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> e=e||<span class="built_in">window</span>.event;</span></span><br><span class="line"><span class="undefined">        eKey=e.keyCode;</span></span><br><span class="line"><span class="actionscript">        ajax(<span class="string">"sug.js"</span>,fnSuccess,fnFail);</span></span><br><span class="line"><span class="undefined">    &#125;    </span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">fnSuccess</span><span class="params">(str)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> e=e||<span class="built_in">window</span>.event;</span></span><br><span class="line"><span class="actionscript">        oUl.innerHTML=<span class="string">""</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span>(oTxt.value!=oldVal)&#123;</span></span><br><span class="line"><span class="undefined">            c=-1;</span></span><br><span class="line"><span class="undefined">            oldVal=oTxt.value;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span>(oTxt.value)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> str=<span class="built_in">eval</span>(<span class="string">"("</span>+str+<span class="string">")"</span>), <span class="comment">// 使用eval解析数组</span></span></span><br><span class="line"><span class="undefined">                val=oTxt.value.toLowerCase(),</span></span><br><span class="line"><span class="undefined">                valLen=oTxt.value.length;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;str.length;i++)&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span>(str[i].substring(<span class="number">0</span>,valLen)==val)&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> oLi=<span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="undefined">                    oLi.innerHTML=str[i];</span></span><br><span class="line"><span class="undefined">                    oUl.appendChild(oLi);</span></span><br><span class="line"><span class="undefined">                    eleShow(oUl);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">                oUl.style.display=<span class="string">"none"</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span>(oUl.style.display==<span class="string">"block"</span>)&#123;</span></span><br><span class="line"><span class="undefined">                mouseLi();</span></span><br><span class="line"><span class="undefined">                keyLi();</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">fnFail</span><span class="params">()</span></span>&#123;&#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="comment">//键盘操作列表选择</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">keyLi</span><span class="params">()</span></span>&#123; </span></span><br><span class="line"><span class="actionscript">        <span class="keyword">switch</span>(eKey)&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 40 下</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 38 上</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 13 enter</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="number">40</span>:</span></span><br><span class="line"><span class="undefined">                c++;</span></span><br><span class="line"><span class="undefined">                listChange();</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="number">38</span>:</span></span><br><span class="line"><span class="undefined">                c--;</span></span><br><span class="line"><span class="undefined">                listChange();</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">case</span> <span class="number">13</span>:</span></span><br><span class="line"><span class="undefined">                eleHide(oUl);</span></span><br><span class="line"><span class="undefined">                oTxt.value=aLi.innerHTML;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">break</span>;        </span></span><br><span class="line"><span class="actionscript">            <span class="keyword">default</span>:</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">break</span>;    </span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">listChange</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span>(c==aLi.length)&#123;</span></span><br><span class="line"><span class="undefined">            c=0;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;aLi.length;i++)&#123;</span></span><br><span class="line"><span class="actionscript">            aLi[i].className=<span class="string">""</span>;    </span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">            aLi.className=<span class="string">"cur"</span>;    </span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="comment">//鼠标操作列表选择</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">mouseLi</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;aLi.length;i++)&#123;</span></span><br><span class="line"><span class="actionscript">            aLi[i].onclick=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">                oTxt.value=<span class="keyword">this</span>.innerHTML;    </span></span><br><span class="line"><span class="undefined">                eleHide(oUl);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="actionscript">            aLi[i].onmouseover=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.className=<span class="string">"cur"</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="actionscript">            aLi[i].onmouseout=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.className=<span class="string">""</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">eleShow</span><span class="params">(obj)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        obj.style.display=<span class="string">"block"</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">eleHide</span><span class="params">(obj)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        obj.style.display=<span class="string">"none"</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;)()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
  </div>

</div>

  <div class="footer">
    <a href="http://www.yi-jy.com">前端技术空间--易建勇</a> /
    <a href="http://www.beianbeian.com/search/yi-jy.com">Copyright © 2012-2018</a> /
    <a href="https://github.com/joy-yi0905/hexo-theme-record">Record</a> /
    <a href="http://yi-jy.com/atom.xml">Rss</a>
  </div>

</div>

</body>


    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7d5550c80ba3b42cfa5323fc0e92699f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


</html>